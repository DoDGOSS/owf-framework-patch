<html>
<head>
    <title>Preference Local Tests</title>
    <script type="text/javascript" src="../../../../js-lib/dojo-release-1.5.0/dojo/dojo.js"></script>
    <script type='text/javascript' src='../../../../js/config/config.js'></script>
    <script type="text/javascript">
      Ozone = Ozone || {};
      Ozone.disableWidgetInit = true;
    </script>
    <script type='text/javascript' src='../../../../js-min/owf-widget-debug.js'></script>
    <script type="text/javascript">

         //The location is assumed to be at /<context>/js/eventing/rpc_relay.uncompressed.html if it is not set
        Ozone.eventing.Widget.widgetRelayURL = Ozone.util.contextPath() + '/js/eventing/rpc_relay.uncompressed.html';

        dojo.registerModulePath("Ozone", "../../../js-doh/Ozone");
        dojo.provide("Ozone.pref.tests.prefLocalTestsHTML");
        dojo.require("dojo.parser");
        dojo.require("doh.runner");
        dojo.require("dojox.io.windowName");
        dojo.require("dojox.secure.capability");

        dojo.addOnLoad(function() {

            var namespace = 'Ozone.pref.tests.prefLocalTests';
            var name = 'test-preference';
            var value = 'test-value';
            var url = Ozone.pref.PrefServer.getUrl();


            //register tests
            doh.register("Ozone.pref.tests.prefLocalTests", [
                {
                    name: "setUserPreference",
                    setUp: function() {
                        //Setup to do before runTest.
                    },
                    runTest: function() {
                        var deferred = new doh.Deferred();

                        Ozone.pref.PrefServer.setUserPreference({namespace:namespace,
                            name:name,
                            value:value,
                            onSuccess:function(result) {
                              doh.assertEqual(result.value,value);
                               dojo.byId('pref').innerHTML+='setting pref value: <b>'+result.value+'</b><br/>';
                              deferred.callback(true);
                            },
                            onFailure:function(err) {
                                deferred.errback(err);
                            }});
                        return deferred;
                    },
                    tearDown: function() {
                        //cleanup to do after runTest.
                    },
                    timeout: 10000 //10 second timeout.
                },
                {
                    name: "getUserPreference",
                    setUp: function() {
                        //Setup to do before runTest.
                    },
                    runTest: function() {
                        var deferred = new doh.Deferred();

                        Ozone.pref.PrefServer.getUserPreference({namespace:namespace,
                            name:name,
                            onSuccess:function(result) {
                              dojo.byId('pref').innerHTML+='getting pref value: <b>'+result.value+'</b><br/>';
                              doh.assertEqual(result.value,value);
                              deferred.callback(true);
                            },
                            onFailure:function(err) {
                                deferred.errback(err);
                            }});

                        return deferred;
                    },
                    tearDown: function() {
                        //cleanup to do after runTest.
                    },
                    timeout: 10000 //10 second timeout.
                },
                {
                    name: "deleteUserPreference",
                    setUp: function() {
                        //Setup to do before runTest.
                    },
                    runTest: function() {
                        var deferred = new doh.Deferred();

                        Ozone.pref.PrefServer.deleteUserPreference({namespace:namespace,
                            name:name,
                            onSuccess:function(result) {
                              if (result.value == undefined) {
                                dojo.byId('pref').innerHTML+='deleting pref value: <b>Not Found</b><br/>';
                              }
                              else {
                                dojo.byId('pref').innerHTML+='deleting pref value:  <b>deleted</b><br/>';
                              }
                              doh.assertEqual(result.value,value);
                              deferred.callback(true);
                            },
                            onFailure:function(err) {
                                deferred.errback(err);
                            }});

                        return deferred;
                    },
                    tearDown: function() {
                        //cleanup to do after runTest.
                    },
                    timeout: 10000 //10 second timeout.
                },
                {
                    name: "getUserPreferencePrefDoesntExist",
                    setUp: function() {
                        //Setup to do before runTest.
                    },
                    runTest: function() {
                        var deferred = new doh.Deferred();

                        Ozone.pref.PrefServer.getUserPreference({namespace:namespace,
                            name:name,
                            onSuccess:function(result) {
                                if (result.value == undefined) {
                                    dojo.byId('pref').innerHTML+='getUserPreferencePrefDoesntExist: getting pref value: <b>Not Found</b><br/>';
                                }
                                else {
                                    dojo.byId('pref').innerHTML+='getUserPreferencePrefDoesntExist: getting pref value: <b>'+result.value+'</b><br/>';
                                }
                              doh.assertEqual(result.value,undefined);
                              deferred.callback(true);
                            },
                            onFailure:function(err) {
                                deferred.errback(err);
                            }});

                        return deferred;
                    },
                    tearDown: function() {
                        //cleanup to do after runTest.
                    },
                    timeout: 10000 //10 second timeout.
                },
                {
                    name: "deleteUserPreferencePrefDoesntExist",
                    setUp: function() {
                        //Setup to do before runTest.
                    },
                    runTest: function() {
                        var deferred = new doh.Deferred();

                        Ozone.pref.PrefServer.deleteUserPreference({namespace:namespace,
                            name:name,
                            onSuccess:function(result) {
                              if (result.value == undefined) {
                                dojo.byId('pref').innerHTML+='deleteUserPreferencePrefDoesntExist: deleting pref value: <b>Not Found</b><br/>';
                              }
                              else {
                                dojo.byId('pref').innerHTML+='deleteUserPreferencePrefDoesntExist: deleting pref value:  <b>deleted</b><br/>';
                              }
                              doh.assertEqual(result.value,undefined);
                              deferred.callback(true);
                            },
                            onFailure:function(err) {
                                deferred.errback(err);
                            }});

                        return deferred;
                    },
                    tearDown: function() {
                        //cleanup to do after runTest.
                    },
                    timeout: 10000 //10 second timeout.
                }
            ]);

            //Execute D.O.H. in this remote file.
            doh.run();

        });
    </script>
</head>
<body>
<h>Preference Local Tests</h>
<div style="border: 2px solid black;">
    <h>Preference</h>
    <div id="pref"></div>
</div>
</body>
</html>
